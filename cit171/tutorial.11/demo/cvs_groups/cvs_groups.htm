<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Central Valley Snowboarding</title>
<link rel="stylesheet" href="js_styles.css" type="text/css">

<script type="text/javascript">
var calendarWin;
function displayCalendar(whichMonth) {
	calendarWin = window.open("", "CalWindow", "status=no,resizable=yes,width=400,height=320,left=200,top=200");
	calendarWin.focus();
	calendarWin.document.write("<!DOCTYPE html><head><title>Central Valley Snowboarding</title><meta charset='UTF-8'><link rel='stylesheet' href='js_styles.css' type='text/css'></head><body>");
	calendarWin.document.write("<table cellspacing='0' border='1' width='100%'>");
	calendarWin.document.write("<colgroup span='7' width='50' />");

	if (whichMonth == -1) {
		dateObject.setMonth(dateObject.getMonth()-1);
	}
	else if (whichMonth == 1) {
		dateObject.setMonth(dateObject.getMonth()+1);
	}
	var month = dateObject.getMonth();
	calendarWin.document.write("<tr><td colspan='2'><a href='' onclick='self.opener.displayCalendar(-1);return false;'>Previous</a></td><td colspan='3' align='center'><strong>" + monthArray[month] + " " + dateObject.getFullYear() + "</strong></td><td colspan='2' align='right'><a href='' onclick='self.opener.displayCalendar(1);return false;'>Next</a></td></tr>");

	calendarWin.document.write("<tr align='center'><td>Sun</td><td>Mon</td> <td>Tue</td><td>Wed</td><td>Thu</td><td>Fri</td><td>Sat</td></tr>");
	calendarWin.document.write("<tr align='center'>");
	dateObject.setDate(1);
	var dayOfWeek = dateObject.getDay();
	for (var i=0; i<dayOfWeek; ++i) {
		calendarWin.document.write("<td>&nbsp;</td>");
	}
	var daysWithDates = 7 - dayOfWeek;
	var dateCounter = 1;
	for (var i=0; i<daysWithDates; ++i) {
		var curDate = monthArray[month] + " " + dateCounter + ", " + dateObject.getFullYear();
		calendarWin.document.write("<td><a href='' onclick='self.opener.document.forms[0].reservationDate.value=\"" + curDate + "\";self.close();'>" + dateCounter + "</a></td>");
		++dateCounter;
	}
	var numDays = 0;
	// January, March, May, July, August, October, December
	if (month == 0 || month == 2 || month == 4 || month == 6 || month == 7 || month == 9 || month == 11) {
		numDays = 31;
	}
	// February
	else if (month == 1) {
		numDays = 28;
	}
	// April, June, September, November
	else if (month == 3 || month == 5 || month == 8 || month == 10) {
		numDays = 30;
	}
	for (var rowCounter = 0; rowCounter < 5; ++rowCounter) {
		var weekDayCounter = 0;
		calendarWin.document.write("<tr align='center'>");
		while (weekDayCounter < 7) {
			var curDate = monthArray[month] + " " + dateCounter + ", " + dateObject.getFullYear();
			if (dateCounter <= numDays)
				calendarWin.document.write("<td><a href='' onclick='self.opener.document.forms[0].reservationDate.value=\"" + curDate + "\";self.close();'>" + dateCounter + "</a></td>");
			else
				calendarWin.document.write("<td>&nbsp;</td>");
			++weekDayCounter;
			++dateCounter;
		}
		calendarWin.document.write("</tr>");
	}
	calendarWin.document.write("</table></body></html>");
}
function closePopup() {
	if (calendarWin.closed == false) {
		calendarWin.close();
	}
	else {
		alert("Popup window already closed.");
	}	
}
function calcGroupDiscount(groupSize) {
	var dailyRate = 49;
	if (groupSize > 5 && groupSize < 10)
		dailyRate = 49 / 1.1;
	else if (groupSize > 10 && groupSize < 25)
		dailyRate = 49 / 1.2;
	else if (groupSize > 24)
		dailyRate = 49 / 1.25;
	var groupRate = groupSize * dailyRate;
	groupRate = Math.round(groupRate);
	document.forms[0].discount.value = groupRate.toLocaleString();
}

function Contact() {
	this.lastName = "";
	this.firstName = "";
	this.telephone = "";
	this.address = "";
	this.city = "";
	this.state = "";
	this.zip = "";
	this.getContacts = getContactInfo;
	this.updateContact = updateSelectedContact;
}
function getContactInfo() {
     document.forms[0].lastname.value = this.lastName;
     document.forms[0].firstname.value = this.firstName;
     document.forms[0].telephone.value = this.telephone;
     document.forms[0].address.value = this.address;
     document.forms[0].city.value = this.city;
     document.forms[0].state.value = this.state;
     document.forms[0].zip.value = this.zip;
}
function updateSelectedContact(curIndex) {
     this.lastName = document.forms[0].lastname.value;
     this.firstName = document.forms[0].firstname.value;
     this.telephone = document.forms[0].telephone.value;
     this.address = document.forms[0].address.value;
     this.city = document.forms[0].city.value;
     this.state = document.forms[0].state.value;
     this.zip = document.forms[0].zip.value;
     document.forms[0].contacts.options[curIndex].value
           = this.lastName + ", " + this.firstName;
     document.forms[0].contacts.options[curIndex].text
           = this.lastName + ", " + this.firstName;
     window.alert("Contact information updated.");
}
var contactList = new Object();
function addContact() {
	var newContact = 0;
	for (contact in contactList) {
		 ++newContact;
	}
	if (document.forms[0].lastname.value == ""
		|| document.forms[0].firstname.value == "") {
		window.alert("You must enter the contact's first and last names.");
	}
	else {
		contactList["contact" + newContact] = new Contact();
		contactList["contact" + newContact].lastName = document.forms[0].lastname.value;
		contactList["contact" + newContact].firstName = document.forms[0].firstname.value;
		contactList["contact" + newContact].telephone = document.forms[0].telephone.value;
		contactList["contact" + newContact].address = document.forms[0].address.value;
		contactList["contact" + newContact].city = document.forms[0].city.value;
		contactList["contact" + newContact].state = document.forms[0].state.value;
		contactList["contact" + newContact].zip = document.forms[0].zip.value;
		var createContact = new Option();
		createContact.value = contactList["contact" + newContact].lastName + ", " + contactList["contact" + newContact].firstName;
		createContact.text = contactList["contact" + newContact].lastName + ", " + contactList["contact" + newContact].firstName;
		document.forms[0].contacts.options[newContact] = createContact;
	}
	calcGroupDiscount(newContact+1);
}
function deleteContact() {
	var contactSelected = false;
	var selectedContact = 0;
	for (var i=0; i<document.forms[0].contacts.options.length;++i) {
		if (document.forms[0].contacts.options[i].selected == true) {
			contactSelected = true;
			selectedContact = i;
			break;
		}
	}
	document.forms[0].contacts.options[i] = null;
	if (contactSelected == true) {
		for (prop in contactList) {
			delete contactList[prop]
		}
		for (var i=0; i<document.forms[0].contacts.options.length;++i) {
			contactList["contact" + i] = new Contact();
			contactList["contact" + i].lastName = document.forms[0].lastname.value;
			contactList["contact" + i].firstName = document.forms[0].firstname.value;
			contactList["contact" + i].telephone = document.forms[0].telephone.value;
			contactList["contact" + i].address = document.forms[0].address.value;
			contactList["contact" + i].city = document.forms[0].city.value;
			contactList["contact" + i].state = document.forms[0].state.value;
			contactList["contact" + i].zip = document.forms[0].zip.value;
		}
	}
	else {
		window.alert("You must select a contact in the list.");
	}
	calcGroupDiscount(document.forms[0].contacts.options.length);
}
</script>

</head>
<body>
<h1>Central Valley Snowboarding</h1>
<h2>Group Reservations</h2><hr />
<form action="form_processor.htm" method="get" enctype="application/x-www-form-urlencoded">
<h3>Snowboarding Date</h3>
<p>
<input type="text" name="reservationDate" />

<script type="text/javascript">
var dateObject = new Date();
var month = dateObject.getMonth();
var monthArray = new Array("January","February","March","April","May","June","July","August","September","October","November","December");
var dateToday = monthArray[month] + " " + dateObject.getDate() + ", " + dateObject.getFullYear();
document.forms[0].reservationDate.value = dateToday;
</script>

<a href="" onclick="displayCalendar(); return false;" >Select Date</a></p>
<h3>Group Leader</h3>
<table border="0">
<tr valign="top">
  <td>Last name<br>
	<input type="text" name="leaderLastName" size="50" /><br>
	First name<br>
	<input type="text" name="leaderFirstName" size="50" /><br>
	Telephone<br>
	<input type="text" name="leaderTelephone" size="50" /><br>
	Address<br>
	<input type="text" name="leaderAddress" size="50" /><br>
	City, State, Zip<br>
	<input type="text" name="leaderCity" size="34" /> <input type="text" name="leaderState" size="2" maxlength="2" />
	<input type="text" name="leaderZip" size="5" maxlength="5" /></td>
</tr>
</table>
<h3>Group Members</h3>
  <p><input type="button" value="Add Snowboarder" onclick="addContact()" />
  <input type="button" value="Delete Snowboarder" onclick="deleteContact()" />
  <input type="button" value="Update Info" onclick="contactList['contact' + document.forms[0].contacts.selectedIndex].updateContact(document.forms[0].contacts.selectedIndex);" /></p>
  <table border="0">
    <tr>
      <td><select name="contacts" multiple="multiple" size="13" style="width: 150px" onclick="contactList['contact' + this.selectedIndex].getContacts();">
          <option value="contacts">Group Members</option>
        </select></td>
      <td>Last name<br>
        <input type="text" name="lastname" size="50" /><br>
        First name<br>
        <input type="text" name="firstname" size="50" /><br>
        Telephone<br>
        <input type="text" name="telephone" size="50" /><br>
        Address<br>
        <input type="text" name="address" size="50" /><br>
        City, State, Zip<br>
        <input type="text" name="city" size="34" /> <input type="text" name="state" size="2" maxlength="2" />
        <input type="text" name="zip" size="5" maxlength="5" /></td>
    </tr>
  </table>
<h3>Group Discounts</h3>
<ul>
<li>Daily Rate: $49</li>
<li>5-10 snowboarders: 10% discount</li>
<li>11-24 snowboarders: 20% discount</li>
<li>25+ snowboarders: 25% discount</li>
</ul>
<p><br>
Your group rate is $<input type="text" name="discount" size="60" value="0" readonly="readonly" style="border: none" /></p>

<p><input type="submit" value="Submit Group Reservation" /></p>
</form>

</body>

</html>


